"use strict";(self.webpackChunkems_ng16=self.webpackChunkems_ng16||[]).push([[298],{9298:(j,g,i)=>{i.r(g),i.d(g,{AuthModule:()=>E});var d=i(6814),c=i(2384),t=i(5879);let h=(()=>{class n{ngAfterViewInit(){document.querySelector(".page-loader")?.classList.add("d-none")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-auth"]],decls:8,vars:0,consts:[[1,"auth-layout"],[1,"container-fluid"],[1,"row","divide-page-center"],[1,"col-12","img-bg"],[1,"form-container"],[1,"text-center"],["src","assets/images/logo.png","width","148px",1,"img-fluid","mb-3"]],template:function(e,o){1&e&&(t.TgZ(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t._UZ(6,"img",6),t.qZA(),t._UZ(7,"router-outlet"),t.qZA()()()()())},dependencies:[c.lC]}),n})();var l=i(6223),p=i(8645),f=i(9773),v=i(3519),b=i.n(v),C=i(2760),A=i(9418),u=i(4544),I=i(5619),m=i(553);let S=(()=>{class n{constructor(){A.d.configure({Auth:{region:"eu-west-1",userPoolId:m.N.cognitoUserPoolId,userPoolWebClientId:m.N.cognitoAppClientId,mandatorySignIn:!0,authenticationFlowType:"USER_SRP_AUTH"}}),this.authenticationSubject=new I.X(!1)}signIn(e){return u.g.signIn(e)}sendChallengeAnswer(e,o){return u.g.sendCustomChallengeAnswer(e,o)}signInOld(e,o){return u.g.signIn(e,o)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Z=i(775),w=i(2030);const y=["content"];function x(n,r){if(1&n&&(t.TgZ(0,"div",16),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.errors," ")}}function T(n,r){1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"uppercase"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Sign In")))}function U(n,r){1&n&&t._UZ(0,"span",17)}function L(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",18)(1,"h4",19),t._uU(2,"Add New Event"),t.qZA(),t.TgZ(3,"button",20),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.KtG(a.dismiss("Cross click"))}),t._UZ(4,"i",21),t.qZA()(),t._UZ(5,"div",22),t.TgZ(6,"div",23)(7,"button",24),t.NdJ("click",function(){const a=t.CHM(e).$implicit;return t.KtG(a.close("Save click"))}),t._uU(8,"Close"),t.qZA()()}if(2&n){const e=t.oxw();t.ekj("disabled",e.isLoading),t.xp6(5),t.ekj("disabled",e.isLoading),t.xp6(1),t.ekj("disabled",e.isLoading)}}const F=[{path:"",component:h,children:[{path:"",component:(()=>{class n{constructor(e,o,s,a,k){this.gs=e,this.as=o,this.es=s,this.modalService=a,this.router=k,this.isLoading=!1,this.unsubscribe$=new p.x,this.errors="",this.loginForm=new l.cw({email:new l.NI("",[l.kI.required,l.kI.minLength(4)]),password:new l.NI("",[l.kI.required,l.kI.minLength(4)])}),this.gs.globals.loggedIn&&this.router.navigate(["/"]),console.log(this.gs.globals.loggedIn),this.getGlobals()}ngOnInit(){}getGlobals(){this.gs.getGlobals().pipe((0,f.R)(this.unsubscribe$)).subscribe(e=>{this.gs.globals=e,console.log(this.gs.globals),this.gs.globals.loggedIn&&this.router.navigate(["/"])})}onSubmit(){this.loginForm.valid?(this.isLoading=!0,this.errors="",this.as.signInOld(this.loginForm.controls.email.value,this.loginForm.controls.password.value).then(s=>{console.log(s),this.gs.globals.userInfo=s.signInUserSession,this.gs.globals.permissions=this.gs.generateUserPermissions(),document.querySelector(".page-loader")?.classList.remove("d-none"),this.checkUser(this.gs.globals.userInfo.idToken.payload)}).catch(s=>{console.log(s),this.errors=s.message,this.isLoading=!1})):this.loginForm.markAllAsTouched()}checkUser(e){console.log(e),"Admin"==e["custom:urole"]||"Usher"==e["custom:urole"]?this.getEventsList(e):(this.errors=e["custom:urole"]+" can't login to dashboard",this.isLoading=!1)}getEventsList(e){console.log(e),this.es.getOrganizationEvents(e["custom:utenantid"]).subscribe(o=>{console.log(o),o?.data?.length>0?(this.gs.globals.userInfo.userEvents=o?.data,this.gs.globals.userInfo.currentEvent=o?.data[0],this.gs.globals.loggedIn=!0,this.gs.updateLocalStorage(this.gs.globals),this.getGlobals()):"Admin"==e["custom:urole"]?(this.gs.globals.userInfo.userEvents=[],b().fire({text:"Do you want to create new event?",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Create",denyButtonText:"Cancel"}).then(s=>{s.isConfirmed?this.createNewEvent():s.isDenied&&(this.isLoading=!1)})):(this.errors="User had no events assigned, please contact your organization admin",this.isLoading=!1)},o=>{this.isLoading=!1})}createNewEvent(){this.isLoading=!1,this.modalService.open(this.content,{centered:!0,size:"xl",backdrop:"static"})}eventAdded(){this.isLoading=!1,this.modalService.dismissAll()}get f(){return this.loginForm.controls}isControlValid(e){const o=this.f[e];return o.valid&&(o.dirty||o.touched)}isControlInvalid(e){const o=this.f[e];return o.invalid&&(o.dirty||o.touched)}controlHasError(e,o){const s=this.f[o];return s.hasError(e)&&(s.dirty||s.touched)}isControlTouched(e){const o=this.f[e];return o.dirty||o.touched}ngOnDestroy(){console.log("distroyed"),this.unsubscribe$.next(),this.unsubscribe$.complete(),console.log("unsubscribe")}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(C.U),t.Y36(S),t.Y36(Z.n),t.Y36(w.FF),t.Y36(c.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-signin"]],viewQuery:function(e,o){if(1&e&&t.Gf(y,5),2&e){let s;t.iGM(s=t.CRH())&&(o.content=s.first)}},decls:20,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"auth-form","row",3,"formGroup","ngSubmit"],["class","alert alert-danger text-center",4,"ngIf"],[1,"form-group","mb-3","col-12"],["for","",1,"fw-bold","fs-14"],["type","text","autocomplete","off","placeholder","Email","formControlName","email",1,"form-control"],[1,"form-group","mb-5","col-12"],["for","",1,"fw-bold"],["type","password","autocomplete","new-password","placeholder","Password","formControlName","password",1,"form-control"],[1,"form-group","col-12"],["type","submit",1,"btn","btn-primary","w-100"],[4,"ngIf"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["content",""],[1,"alert","alert-danger","text-center"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"btn","btn-icon","btn-sm","close",3,"click"],[1,"fas","fa-times"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-dark",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),t.NdJ("ngSubmit",function(){return o.onSubmit()}),t.TgZ(4,"div",2),t.YNc(5,x,2,1,"div",4),t.qZA(),t.TgZ(6,"div",5)(7,"label",6),t._uU(8,"Email"),t.qZA(),t._UZ(9,"input",7),t.qZA(),t.TgZ(10,"div",8)(11,"label",9),t._uU(12,"Password"),t.qZA(),t._UZ(13,"input",10),t.qZA(),t.TgZ(14,"div",11)(15,"button",12),t.YNc(16,T,3,3,"span",13),t.YNc(17,U,1,0,"span",14),t.qZA()()()()()(),t.YNc(18,L,9,6,"ng-template",null,15,t.W1O)),2&e&&(t.xp6(2),t.ekj("disabled",o.isLoading),t.xp6(1),t.Q6J("formGroup",o.loginForm),t.xp6(2),t.Q6J("ngIf",""!=o.errors),t.xp6(4),t.ekj("is-invalid",o.isControlInvalid("email")),t.xp6(4),t.ekj("is-invalid",o.isControlInvalid("password")),t.xp6(3),t.Q6J("ngIf",!o.isLoading),t.xp6(1),t.Q6J("ngIf",o.isLoading))},dependencies:[d.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,d.gd]}),n})()}]}];let N=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[c.Bz.forChild(F),c.Bz]}),n})(),E=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[d.ez,N,l.u5,l.UX]}),n})()}}]);