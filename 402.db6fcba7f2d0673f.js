"use strict";(self.webpackChunkteachersPension=self.webpackChunkteachersPension||[]).push([[402],{5402:(me,Z,m)=>{m.r(Z),m.d(Z,{RolesModule:()=>ae});var c=m(6814),C=m(2384),e=m(5879),x=m(1674);let T=(()=>{class o{constructor(s){this.gs=s,this.setBreadcrumb()}setBreadcrumb(){this.gs.setBreadcrumb([{name:"\u0644\u0648\u062d\u0629 \u0627\u0644\u062a\u062d\u0643\u0645",url:"/"},{name:"\u0627\u0644\u0623\u062f\u0648\u0627\u0631",url:"/roles"}])}}return o.\u0275fac=function(s){return new(s||o)(e.Y36(x.U))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-roles"]],decls:1,vars:0,template:function(s,t){1&s&&e._UZ(0,"router-outlet")},dependencies:[C.lC]}),o})();var _=m(8645),p=m(9773),b=m(627),A=m(3519),u=m.n(A),v=m(553),g=m(3999),f=m(8862),h=m(3550),l=m(6223);function y(o,n){if(1&o&&(e.TgZ(0,"div",11),e._uU(1),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",null==s.errors?null:s.errors.name," ")}}function q(o,n){if(1&o&&(e.TgZ(0,"div",11),e._uU(1),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",null==s.errors?null:s.errors.display_name," ")}}function P(o,n){if(1&o&&(e.TgZ(0,"div",11),e._uU(1),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",null==s.errors?null:s.errors.description," ")}}function w(o,n){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"Labels.Save")))}function R(o,n){1&o&&e._UZ(0,"span",15)}function F(o,n){if(1&o&&(e.TgZ(0,"button",12),e.YNc(1,w,3,3,"span",13),e.YNc(2,R,1,0,"span",14),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngIf",!s.isLoading),e.xp6(1),e.Q6J("ngIf",s.isLoading)}}let k=(()=>{class o{constructor(s){this.rs=s,this.rolesChanged=new e.vpe,this.errors="",this.isLoading=!1,this.unsubscribe$=new _.x,this.roleForm=new l.cw({name:new l.NI("",[l.kI.required,l.kI.minLength(2)]),display_name:new l.NI("",[l.kI.required,l.kI.minLength(2)]),description:new l.NI("",[l.kI.required,l.kI.minLength(2)])})}ngOnInit(){console.log(this.mode),"add"==this.mode||("edit"==this.mode||"view"==this.mode)&&(console.log(this.roleData),this.setFormInitValues())}setFormInitValues(){this.roleForm.controls.name.setValue(this.roleData.name),this.roleForm.controls.display_name.setValue(this.roleData.display_name),this.roleForm.controls.description.setValue(this.roleData.description)}onSubmit(){if(this.roleForm.valid){this.isLoading=!0,this.errors="";let s={display_name:this.roleForm.controls.display_name.value,description:this.roleForm.controls.description.value};"add"==this.mode?(s.name=this.roleForm.controls.name.value,this.addRole(s)):"edit"==this.mode&&(s.id=this.roleData.id,this.editRole(s))}else this.roleForm.markAllAsTouched()}addRole(s){this.rs.addRole(s).pipe((0,p.R)(this.unsubscribe$)).subscribe(t=>{console.log(t),t?.success?(u().fire({icon:"success",text:`${t?.message}`,showConfirmButton:!1,timer:1500}),this.rolesChanged.emit(!0)):(this.errors=t.errors,console.log(this.errors),this.isLoading=!1)})}editRole(s){this.rs.updateRole(s).pipe((0,p.R)(this.unsubscribe$)).subscribe(t=>{console.log(t),t?.success?(u().fire({icon:"success",text:`${t?.message}`,showConfirmButton:!1,timer:1500}),this.rolesChanged.emit(!0)):(this.errors=t.errors,console.log(this.errors),this.isLoading=!1)})}get f(){return this.roleForm.controls}isControlValid(s){const t=this.f[s];return t.valid&&(t.dirty||t.touched)}isControlInvalid(s){const t=this.f[s];return t.invalid&&(t.dirty||t.touched)}controlHasError(s,t){const i=this.f[t];return i.hasError(s)&&(i.dirty||i.touched)}isControlTouched(s){const t=this.f[s];return t.dirty||t.touched}ngOnDestroy(){console.log("distroyed"),this.unsubscribe$.next(),this.unsubscribe$.complete(),console.log("unsubscribe")}}return o.\u0275fac=function(s){return new(s||o)(e.Y36(f.f))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-role-form"]],inputs:{mode:"mode",roleData:"roleData"},outputs:{rolesChanged:"rolesChanged"},decls:27,vars:39,consts:[[1,"row"],[1,"col-12"],["autocomplete","off",1,"auth-form","row",3,"formGroup","ngSubmit"],[1,"form-group","mb-3","col-12"],["for","",1,"fw-bold"],["type","text","autocomplete","off","formControlName","name",1,"form-control",3,"placeholder"],["class","alert text-bg-danger d-inline-block mb-0 mt-1 p-1 text-center",4,"ngIf"],["type","text","autocomplete","off","formControlName","display_name",1,"form-control",3,"placeholder"],["type","text","rows","3","autocomplete","off","formControlName","description",1,"form-control",3,"placeholder"],[1,"form-group","col-12"],["type","submit","class","btn btn-primary w-100",4,"ngIf"],[1,"alert","text-bg-danger","d-inline-block","mb-0","mt-1","p-1","text-center"],["type","submit",1,"btn","btn-primary","w-100"],[4,"ngIf"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(s,t){1&s&&(e.TgZ(0,"div",0)(1,"div",1)(2,"form",2),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e._UZ(3,"div",1),e.TgZ(4,"div",3)(5,"label",4),e._uU(6),e.ALo(7,"translate"),e.qZA(),e._UZ(8,"input",5),e.ALo(9,"translate"),e.YNc(10,y,2,1,"div",6),e.qZA(),e.TgZ(11,"div",3)(12,"label",4),e._uU(13),e.ALo(14,"translate"),e.qZA(),e._UZ(15,"input",7),e.ALo(16,"translate"),e.YNc(17,q,2,1,"div",6),e.qZA(),e.TgZ(18,"div",3)(19,"label",4),e._uU(20),e.ALo(21,"translate"),e.qZA(),e._UZ(22,"textarea",8),e.ALo(23,"translate"),e.YNc(24,P,2,1,"div",6),e.qZA(),e.TgZ(25,"div",9),e.YNc(26,F,3,2,"button",10),e.qZA()()()()),2&s&&(e.ekj("disabled","view"==t.mode),e.xp6(1),e.ekj("disabled",t.isLoading),e.xp6(1),e.Q6J("formGroup",t.roleForm),e.xp6(4),e.Oqu(e.lcZ(7,27,"Labels.Name")),e.xp6(2),e.ekj("is-invalid",t.isControlInvalid("name"))("is-valid",t.isControlValid("name")),e.s9C("placeholder",e.lcZ(9,29,"Labels.Name")),e.xp6(2),e.Q6J("ngIf",null==t.errors?null:t.errors.name),e.xp6(3),e.Oqu(e.lcZ(14,31,"Labels.DisplayName")),e.xp6(2),e.ekj("is-invalid",t.isControlInvalid("display_name"))("is-valid",t.isControlValid("display_name")),e.s9C("placeholder",e.lcZ(16,33,"Labels.DisplayName")),e.xp6(2),e.Q6J("ngIf",null==t.errors?null:t.errors.display_name),e.xp6(3),e.Oqu(e.lcZ(21,35,"Labels.Description")),e.xp6(2),e.ekj("is-invalid",t.isControlInvalid("description"))("is-valid",t.isControlValid("description")),e.s9C("placeholder",e.lcZ(23,37,"Labels.Description")),e.xp6(2),e.Q6J("ngIf",null==t.errors?null:t.errors.description),e.xp6(2),e.Q6J("ngIf","view"!=t.mode))},dependencies:[c.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,g.X$]}),o})();const L=["dashboard","users","roles","reports","members"];function N(o,n){1&o&&(e.TgZ(0,"div",6),e._UZ(1,"div",7),e.qZA())}function M(o,n){if(1&o){const s=e.EpF();e.TgZ(0,"div",14)(1,"input",15),e.NdJ("click",function(){const r=e.CHM(s).$implicit,a=e.oxw(2).index,d=e.oxw();return e.KtG(d.togglePerm(a,r.id))}),e.qZA(),e.TgZ(2,"label",16),e._uU(3),e.qZA()()}if(2&o){const s=n.$implicit,t=n.index,i=e.oxw(2).index,r=e.oxw();e.xp6(1),e.hYB("id","flexSwitchCheck-",i,"-",t,""),e.Q6J("checked",!!r.rolesPermissionsList[i].assignedPermissions.includes(s.id)),e.xp6(1),e.hYB("for","flexSwitchCheck-",i,"-",t,""),e.xp6(1),e.Oqu(null==s?null:s.display_name)}}function U(o,n){if(1&o&&(e.TgZ(0,"div",12),e.YNc(1,M,4,6,"div",13),e.qZA()),2&o){const s=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",null==s?null:s.permissions)}}function O(o,n){1&o&&(e.TgZ(0,"div",17),e._uU(1," No Permissions Found For This Module "),e.qZA())}function I(o,n){if(1&o&&(e.TgZ(0,"div",8)(1,"div",9)(2,"h6"),e._uU(3),e.qZA()(),e.YNc(4,U,2,1,"div",10),e.YNc(5,O,2,0,"div",11),e.qZA()),2&o){const s=n.$implicit,t=e.oxw();e.xp6(3),e.Oqu(t.moduleName(s.name)),e.xp6(1),e.Q6J("ngIf",(null==s||null==s.permissions?null:s.permissions.length)>0),e.xp6(1),e.Q6J("ngIf",0==(null==s||null==s.permissions?null:s.permissions.length))}}let J=(()=>{class o{constructor(s,t,i){this.rs=s,this.trans=t,this.titleCasePipe=i,this.isLoading=!0,this.unsubscribe$=new _.x,this.rolesChanged=new e.vpe,this.modules=L,this.rolesPermissionsList=[],this.tempPermissionsList=[]}ngOnInit(){console.log(this.roleData),this.roleData&&this.getPermissions()}mapRoles(){const s=this.roleData.permissions.reduce((t,i)=>(t[i.model_name]||(t[i.model_name]=[]),t[i.model_name].push(i),t),{});this.groupedPermissions=s,console.log(this.groupedPermissions),this.createModelPermissions()}getPermissions(){this.isLoading=!0,this.rs.getPermissions().pipe((0,p.R)(this.unsubscribe$)).subscribe(s=>{this.permissionList=s?.data,this.isLoading=!1;const t=this.permissionList.reduce((i,r)=>(i[r.model_name]||(i[r.model_name]=[]),i[r.model_name].push(r),i),{});console.log(t),console.log(s),this.permissionList=t,this.mapRoles()})}createModelPermissions(){console.log(this.modules),this.modules.forEach(s=>{let t=this.groupedPermissions[s]?.map(r=>r.id);this.rolesPermissionsList.push({name:s,permissions:this.permissionList[s]||[],assignedPermissions:t||[]})}),console.log(this.rolesPermissionsList)}togglePerm(s,t){this.rolesPermissionsList[s].assignedPermissions.includes(t)?this.rolesPermissionsList[s].assignedPermissions.splice(this.rolesPermissionsList[s].assignedPermissions.indexOf(t),1):this.rolesPermissionsList[s].assignedPermissions.push(t),console.log(this.rolesPermissionsList)}moduleName(s){return s=this.titleCasePipe.transform(s),this.trans.instant("Roles"==s?"Modules.RolesPermissions":`Modules.${s}.Title`)}updateAll(){let s=[];console.log(this.rolesPermissionsList),this.rolesPermissionsList.forEach(i=>{s=s.concat(i.assignedPermissions)}),console.log(s),console.log(this.roleData.id);let t={role_id:this.roleData.id,permissions:s};this.isLoading=!0,this.rs.assignPermissions(t).pipe((0,p.R)(this.unsubscribe$)).subscribe(i=>{console.log(i),u().fire({icon:"success",text:`${i?.message}`,showConfirmButton:!1,timer:1500}),this.rolesChanged.emit(!0)},i=>{console.log(i)})}ngOnDestroy(){console.log("distroyed"),this.unsubscribe$.next(),this.unsubscribe$.complete(),console.log("unsubscribe")}}return o.\u0275fac=function(s){return new(s||o)(e.Y36(f.f),e.Y36(g.sK),e.Y36(c.rS))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-assign-permissions"]],inputs:{roleData:"roleData"},outputs:{rolesChanged:"rolesChanged"},decls:7,vars:4,consts:[["class","progress mb-3",4,"ngIf"],[1,"container"],["class","row mb-2 py-2 border",4,"ngFor","ngForOf"],[1,"row"],[1,"col-12","px-0","py-3"],[1,"btn","btn-primary","px-4",3,"click"],[1,"progress","mb-3"],["role","progressbar","aria-label","Animated striped example","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated",2,"width","100%"],[1,"row","mb-2","py-2","border"],[1,"col-12"],["class","row px-4",4,"ngIf"],["class","text-center text-bg-info",4,"ngIf"],[1,"row","px-4"],["class","form-check form-switch col-md-3",4,"ngFor","ngForOf"],[1,"form-check","form-switch","col-md-3"],["type","checkbox","role","switch",1,"form-check-input",3,"id","checked","click"],[1,"form-check-label",3,"for"],[1,"text-center","text-bg-info"]],template:function(s,t){1&s&&(e.YNc(0,N,2,0,"div",0),e.TgZ(1,"div",1),e.YNc(2,I,6,3,"div",2),e.TgZ(3,"div",3)(4,"div",4)(5,"button",5),e.NdJ("click",function(){return t.updateAll()}),e._uU(6,"Update"),e.qZA()()()()),2&s&&(e.Q6J("ngIf",t.isLoading),e.xp6(1),e.ekj("disabled",t.isLoading),e.xp6(1),e.Q6J("ngForOf",t.rolesPermissionsList))},dependencies:[c.sg,c.O5]}),o})();function $(o,n){if(1&o){const s=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"date"),e.qZA(),e.TgZ(6,"td",9)(7,"a",15),e.NdJ("click",function(){const r=e.CHM(s).$implicit,a=e.oxw(),d=e.MAs(30);return a.openModal(d),e.KtG(a.selectRole(r))}),e._UZ(8,"i",16),e.qZA(),e.TgZ(9,"a",17),e.NdJ("click",function(){const r=e.CHM(s).$implicit,a=e.oxw(),d=e.MAs(24);return a.openOffcanvas(d),e.KtG(a.selectRole(r))}),e._UZ(10,"i",18),e.qZA(),e.TgZ(11,"a",19),e.NdJ("click",function(){const r=e.CHM(s).$implicit,a=e.oxw(),d=e.MAs(28);return a.openModal(d),e.KtG(a.selectRole(r))}),e._UZ(12,"i",20),e.qZA(),e.TgZ(13,"a",21),e.NdJ("click",function(){const r=e.CHM(s).$implicit,a=e.oxw();return e.KtG(a.deleteRole(r))}),e._UZ(14,"i",22),e.qZA()()()}if(2&o){const s=n.$implicit;e.xp6(2),e.Oqu(s.display_name),e.xp6(2),e.Oqu(e.xi3(5,2,s.updated_at,"medium"))}}function Y(o,n){if(1&o){const s=e.EpF();e.TgZ(0,"div",23)(1,"h4",24),e._uU(2),e.qZA(),e.TgZ(3,"button",25),e.NdJ("click",function(){const r=e.CHM(s).$implicit;return e.KtG(r.dismiss("Cross click"))}),e.qZA()(),e.TgZ(4,"div",26)(5,"app-assign-permissions",27),e.NdJ("rolesChanged",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.rolesChanged())}),e.qZA()()}if(2&o){const s=e.oxw();e.xp6(2),e.hij("",s.selectedRole.display_name," "),e.xp6(3),e.Q6J("roleData",s.selectedRole)}}function D(o,n){if(1&o){const s=e.EpF();e.TgZ(0,"div",28)(1,"h5",29),e._uU(2),e.ALo(3,"translate"),e.qZA()(),e.TgZ(4,"div",30)(5,"app-role-form",31),e.NdJ("rolesChanged",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.rolesChanged())}),e.qZA()(),e.TgZ(6,"div",32)(7,"button",33),e.NdJ("click",function(){const r=e.CHM(s).$implicit;return e.KtG(r.close("Close click"))}),e._uU(8),e.ALo(9,"translate"),e.qZA()()}2&o&&(e.xp6(2),e.Oqu(e.lcZ(3,3,"Modules.Roles.AddRole")),e.xp6(3),e.Q6J("mode","add"),e.xp6(3),e.Oqu(e.lcZ(9,5,"Labels.Close")))}function Q(o,n){if(1&o){const s=e.EpF();e.TgZ(0,"div",28)(1,"h5",29),e._uU(2),e.ALo(3,"translate"),e.qZA()(),e.TgZ(4,"div",30)(5,"app-role-form",34),e.NdJ("rolesChanged",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.rolesChanged())}),e.qZA()(),e.TgZ(6,"div",32)(7,"button",33),e.NdJ("click",function(){const r=e.CHM(s).$implicit;return e.KtG(r.close("Close click"))}),e._uU(8),e.ALo(9,"translate"),e.qZA()()}if(2&o){const s=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,4,"Modules.Roles.EditRole")),e.xp6(3),e.Q6J("mode","edit")("roleData",s.selectedRole),e.xp6(3),e.Oqu(e.lcZ(9,6,"Labels.Close"))}}function G(o,n){if(1&o){const s=e.EpF();e.TgZ(0,"div",28)(1,"h5",29),e._uU(2),e.ALo(3,"translate"),e.qZA()(),e.TgZ(4,"div",30)(5,"app-role-form",34),e.NdJ("rolesChanged",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.rolesChanged())}),e.qZA()(),e.TgZ(6,"div",32)(7,"button",33),e.NdJ("click",function(){const r=e.CHM(s).$implicit;return e.KtG(r.close("Close click"))}),e._uU(8),e.ALo(9,"translate"),e.qZA()()}if(2&o){const s=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,4,"Modules.Roles.ViewRole")),e.xp6(3),e.Q6J("mode","view")("roleData",s.selectedRole),e.xp6(3),e.Oqu(e.lcZ(9,6,"Labels.Close"))}}let j=(()=>{class o{constructor(s,t,i,r,a){this.gs=s,this.trans=t,this.rs=i,this.modalService=r,this.offcanvasService=a,this.isLoading=!1,this.unsubscribe$=new _.x,this.roleList=[],this.dtOptions={},this.dtTrigger=new _.x,this.setBreadcrumb(),this.getRoles()}ngOnInit(){this.dtOptions={pagingType:"simple_numbers",pageLength:12,responsive:!0,dom:"frtip",language:v.N.dtLanguage}}ngAfterViewInit(){this.dtTrigger.next()}setBreadcrumb(){this.gs.setBreadcrumb([{name:"\u0644\u0648\u062d\u0629 \u0627\u0644\u062a\u062d\u0643\u0645",url:"/"},{name:"\u0627\u0644\u0623\u062f\u0648\u0627\u0631",url:"/roles"}])}selectRole(s){this.selectedRole=s,console.log(this.selectedRole)}rolesChanged(){this.modalService.dismissAll(),this.offcanvasService.dismiss(),this.getRoles()}getRoles(){this.isLoading=!0,this.rs.getRoles().pipe((0,p.R)(this.unsubscribe$)).subscribe(s=>{this.roleList=s?.data,this.isLoading=!1,this.rerender(),console.log(s)})}openModal(s){this.modalService.open(s,{size:"xl",centered:!0})}openOffcanvas(s){this.offcanvasService.open(s,{position:"bottom"})}deleteRole(s){u().fire({title:this.trans.instant("Messages.Sure?"),text:this.trans.instant("Messages.CntRvrt"),icon:"warning",showCancelButton:!0,cancelButtonText:this.trans.instant("Labels.Cancel"),confirmButtonText:this.trans.instant("Labels.Delete")}).then(t=>{t.isConfirmed&&(this.isLoading=!0,this.rs.deleteRole(s.id).pipe((0,p.R)(this.unsubscribe$)).subscribe(i=>{console.log(i),this.isLoading=!1,this.getRoles(),i.success&&u().fire({icon:"success",text:`${i?.message}`,showConfirmButton:!1,timer:1500})}))})}rerender(){this.dtElement.dtInstance.then(s=>{s.destroy(),this.dtTrigger.next()})}ngOnDestroy(){console.log("distroyed"),this.unsubscribe$.next(),this.unsubscribe$.complete(),console.log("unsubscribe")}}return o.\u0275fac=function(s){return new(s||o)(e.Y36(x.U),e.Y36(g.sK),e.Y36(f.f),e.Y36(h.FF),e.Y36(h._B))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-roles-list"]],viewQuery:function(s,t){if(1&s&&e.Gf(b.G,5),2&s){let i;e.iGM(i=e.CRH())&&(t.dtElement=i.first)}},decls:31,vars:21,consts:[[1,"page-title"],[1,"text"],[1,"actions"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"fa-solid","fa-plus"],[1,""],[1,"table-responsive"],["datatable","",1,"table","table-hover",3,"dtOptions","dtTrigger"],["scope","col"],[1,"minw-150","text-end"],[4,"ngFor","ngForOf"],["content",""],["addModal",""],["editModal",""],["viewModal",""],["ngbTooltip","\u0639\u0631\u0636",1,"btn","btn-primary","btn-icon",3,"click"],[1,"fa-regular","fa-eye"],["ngbTooltip","\u062a\u0639\u064a\u064a\u0646 \u0625\u0630\u0646",1,"btn","btn-dark","btn-icon",3,"click"],[1,"fa-solid","fa-person-circle-plus"],["ngbTooltip","\u062a\u0639\u062f\u064a\u0644",1,"btn","btn-secondary","btn-icon",3,"click"],[1,"fa-regular","fa-pen-to-square"],["ngbTooltip","\u062d\u0630\u0641",1,"btn","btn-danger","btn-icon",3,"click"],[1,"fa-regular","fa-trash-can"],[1,"offcanvas-header"],[1,"offcanvas-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"offcanvas-body"],[3,"roleData","rolesChanged"],[1,"modal-header"],["ngbAutofocus","",1,"modal-title"],[1,"modal-body"],[3,"mode","rolesChanged"],[1,"modal-footer"],["type","button",1,"btn","btn-light","btn-sm",3,"click"],[3,"mode","roleData","rolesChanged"]],template:function(s,t){if(1&s){const i=e.EpF();e.TgZ(0,"div",0)(1,"div",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",2)(5,"a",3),e.NdJ("click",function(){e.CHM(i);const a=e.MAs(26);return e.KtG(t.openModal(a))}),e._UZ(6,"i",4),e._uU(7),e.ALo(8,"translate"),e.qZA()()(),e.TgZ(9,"div",5)(10,"div",6)(11,"table",7)(12,"thead")(13,"tr")(14,"th",8),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"th",8),e._uU(18),e.ALo(19,"translate"),e.qZA(),e._UZ(20,"th",9),e.qZA()(),e.TgZ(21,"tbody"),e.YNc(22,$,15,5,"tr",10),e.qZA()()()(),e.YNc(23,Y,6,2,"ng-template",null,11,e.W1O),e.YNc(25,D,10,7,"ng-template",null,12,e.W1O),e.YNc(27,Q,10,8,"ng-template",null,13,e.W1O),e.YNc(29,G,10,8,"ng-template",null,14,e.W1O)}2&s&&(e.ekj("disabled",t.isLoading),e.xp6(2),e.hij(" ",e.lcZ(3,13,"Modules.Roles.Title")," "),e.xp6(5),e.hij(" ",e.lcZ(8,15,"Modules.Roles.AddRole"),""),e.xp6(2),e.ekj("loading-data",t.isLoading)("disabled",t.isLoading),e.xp6(2),e.Q6J("dtOptions",t.dtOptions)("dtTrigger",t.dtTrigger),e.xp6(4),e.Oqu(e.lcZ(16,17,"Labels.Name")),e.xp6(3),e.Oqu(e.lcZ(19,19,"Labels.UpdatedAt")),e.xp6(4),e.Q6J("ngForOf",t.roleList))},dependencies:[c.sg,h._L,b.G,k,J,c.uU,g.X$]}),o})();function K(o,n){if(1&o&&(e.TgZ(0,"div",13),e._uU(1),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",null==s.errors?null:s.errors.name," ")}}function S(o,n){if(1&o&&(e.TgZ(0,"option",14),e._uU(1),e.ALo(2,"titlecase"),e.qZA()),2&o){const s=n.$implicit;e.Q6J("value",s),e.xp6(1),e.Oqu(e.lcZ(2,2,s))}}function H(o,n){if(1&o&&(e.TgZ(0,"div",13),e._uU(1),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",null==s.errors?null:s.errors.model_name," ")}}function B(o,n){if(1&o&&(e.TgZ(0,"div",13),e._uU(1),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",null==s.errors?null:s.errors.display_name," ")}}function E(o,n){if(1&o&&(e.TgZ(0,"div",13),e._uU(1),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",null==s.errors?null:s.errors.description," ")}}function V(o,n){1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"Labels.Save")))}function X(o,n){1&o&&e._UZ(0,"span",18)}function W(o,n){if(1&o&&(e.TgZ(0,"button",15),e.YNc(1,V,3,3,"span",16),e.YNc(2,X,1,0,"span",17),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngIf",!s.isLoading),e.xp6(1),e.Q6J("ngIf",s.isLoading)}}let z=(()=>{class o{constructor(s){this.rs=s,this.permissionsChanged=new e.vpe,this.systemModules=L,this.errors="",this.isLoading=!1,this.unsubscribe$=new _.x,this.permissionForm=new l.cw({name:new l.NI("",[l.kI.required,l.kI.minLength(2)]),display_name:new l.NI("",[l.kI.required,l.kI.minLength(2)]),model_name:new l.NI("",[l.kI.required]),description:new l.NI("",[l.kI.required,l.kI.minLength(2)])})}ngOnInit(){console.log(this.mode),"add"==this.mode||("edit"==this.mode||"view"==this.mode)&&(console.log(this.permissionData),this.setFormInitValues())}setFormInitValues(){this.permissionForm.controls.name.setValue(this.permissionData.name),this.permissionForm.controls.display_name.setValue(this.permissionData.display_name),this.permissionForm.controls.description.setValue(this.permissionData.description),this.permissionForm.controls.model_name.setValue(this.permissionData.model_name)}onSubmit(){if(this.permissionForm.valid){this.isLoading=!0,this.errors="";let s={display_name:this.permissionForm.controls.display_name.value,description:this.permissionForm.controls.description.value,model_name:this.permissionForm.controls.model_name.value};"add"==this.mode?(s.name=this.permissionForm.controls.name.value,this.addPermission(s)):"edit"==this.mode&&(s.id=this.permissionData.id,this.editPermission(s))}else this.permissionForm.markAllAsTouched()}addPermission(s){this.rs.addPermission(s).pipe((0,p.R)(this.unsubscribe$)).subscribe(t=>{console.log(t),t?.success?(u().fire({icon:"success",text:`${t?.message}`,showConfirmButton:!1,timer:1500}),this.permissionsChanged.emit(!0)):(this.errors=t.errors,console.log(this.errors),this.isLoading=!1)})}editPermission(s){this.rs.updatePermission(s).pipe((0,p.R)(this.unsubscribe$)).subscribe(t=>{console.log(t),t?.success?(u().fire({icon:"success",text:`${t?.message}`,showConfirmButton:!1,timer:1500}),this.permissionsChanged.emit(!0)):(this.errors=t.errors,console.log(this.errors),this.isLoading=!1)})}get f(){return this.permissionForm.controls}isControlValid(s){const t=this.f[s];return t.valid&&(t.dirty||t.touched)}isControlInvalid(s){const t=this.f[s];return t.invalid&&(t.dirty||t.touched)}controlHasError(s,t){const i=this.f[t];return i.hasError(s)&&(i.dirty||i.touched)}isControlTouched(s){const t=this.f[s];return t.dirty||t.touched}ngOnDestroy(){console.log("distroyed"),this.unsubscribe$.next(),this.unsubscribe$.complete(),console.log("unsubscribe")}}return o.\u0275fac=function(s){return new(s||o)(e.Y36(f.f))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-permission-form"]],inputs:{mode:"mode",permissionData:"permissionData"},outputs:{permissionsChanged:"permissionsChanged"},decls:34,vars:48,consts:[[1,"row"],[1,"col-12"],["autocomplete","off",1,"auth-form","row",3,"formGroup","ngSubmit"],[1,"form-group","mb-3","col-12"],["for","",1,"fw-bold"],["type","text","autocomplete","off","formControlName","name",1,"form-control",3,"placeholder"],["class","alert text-bg-danger d-inline-block mb-0 mt-1 p-1 text-center",4,"ngIf"],["formControlName","model_name",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],["type","text","autocomplete","off","formControlName","display_name",1,"form-control",3,"placeholder"],["type","text","rows","3","autocomplete","off","formControlName","description",1,"form-control",3,"placeholder"],[1,"form-group","col-12"],["type","submit","class","btn btn-primary w-100",4,"ngIf"],[1,"alert","text-bg-danger","d-inline-block","mb-0","mt-1","p-1","text-center"],[3,"value"],["type","submit",1,"btn","btn-primary","w-100"],[4,"ngIf"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(s,t){1&s&&(e.TgZ(0,"div",0)(1,"div",1)(2,"form",2),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e._UZ(3,"div",1),e.TgZ(4,"div",3)(5,"label",4),e._uU(6),e.ALo(7,"translate"),e.qZA(),e._UZ(8,"input",5),e.ALo(9,"translate"),e.YNc(10,K,2,1,"div",6),e.qZA(),e.TgZ(11,"div",3)(12,"label",4),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"select",7),e.YNc(16,S,3,4,"option",8),e.qZA(),e.YNc(17,H,2,1,"div",6),e.qZA(),e.TgZ(18,"div",3)(19,"label",4),e._uU(20),e.ALo(21,"translate"),e.qZA(),e._UZ(22,"input",9),e.ALo(23,"translate"),e.YNc(24,B,2,1,"div",6),e.qZA(),e.TgZ(25,"div",3)(26,"label",4),e._uU(27),e.ALo(28,"translate"),e.qZA(),e._UZ(29,"textarea",10),e.ALo(30,"translate"),e.YNc(31,E,2,1,"div",6),e.qZA(),e.TgZ(32,"div",11),e.YNc(33,W,3,2,"button",12),e.qZA()()()()),2&s&&(e.ekj("disabled","view"==t.mode),e.xp6(1),e.ekj("disabled",t.isLoading),e.xp6(1),e.Q6J("formGroup",t.permissionForm),e.xp6(4),e.Oqu(e.lcZ(7,34,"Labels.Name")),e.xp6(2),e.ekj("is-invalid",t.isControlInvalid("name"))("is-valid",t.isControlValid("name")),e.s9C("placeholder",e.lcZ(9,36,"Labels.Name")),e.xp6(2),e.Q6J("ngIf",null==t.errors?null:t.errors.name),e.xp6(3),e.Oqu(e.lcZ(14,38,"Labels.Model")),e.xp6(2),e.ekj("is-invalid",t.isControlInvalid("model_name"))("is-valid",t.isControlValid("model_name")),e.xp6(1),e.Q6J("ngForOf",t.systemModules),e.xp6(1),e.Q6J("ngIf",null==t.errors?null:t.errors.model_name),e.xp6(3),e.Oqu(e.lcZ(21,40,"Labels.DisplayName")),e.xp6(2),e.ekj("is-invalid",t.isControlInvalid("display_name"))("is-valid",t.isControlValid("display_name")),e.s9C("placeholder",e.lcZ(23,42,"Labels.DisplayName")),e.xp6(2),e.Q6J("ngIf",null==t.errors?null:t.errors.display_name),e.xp6(3),e.Oqu(e.lcZ(28,44,"Labels.Description")),e.xp6(2),e.ekj("is-invalid",t.isControlInvalid("description"))("is-valid",t.isControlValid("description")),e.s9C("placeholder",e.lcZ(30,46,"Labels.Description")),e.xp6(2),e.Q6J("ngIf",null==t.errors?null:t.errors.description),e.xp6(2),e.Q6J("ngIf","view"!=t.mode))},dependencies:[c.sg,c.O5,l._Y,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.JL,l.sg,l.u,c.rS,g.X$]}),o})();function ee(o,n){1&o&&(e.TgZ(0,"div",16),e._UZ(1,"div",17),e.qZA())}function se(o,n){if(1&o){const s=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"titlecase"),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"date"),e.qZA(),e.TgZ(9,"td",11)(10,"a",18),e.NdJ("click",function(){const r=e.CHM(s).$implicit,a=e.oxw(),d=e.MAs(32);return a.openModal(d),e.KtG(a.selectPermission(r))}),e._UZ(11,"i",19),e.qZA(),e.TgZ(12,"a",20),e.NdJ("click",function(){const r=e.CHM(s).$implicit,a=e.oxw(),d=e.MAs(30);return a.openModal(d),e.KtG(a.selectPermission(r))}),e._UZ(13,"i",21),e.qZA(),e.TgZ(14,"a",22),e.NdJ("click",function(){const r=e.CHM(s).$implicit,a=e.oxw();return e.KtG(a.deletePermission(r))}),e._UZ(15,"i",23),e.qZA()()()}if(2&o){const s=n.$implicit;e.xp6(2),e.Oqu(s.display_name),e.xp6(2),e.Oqu(e.lcZ(5,3,s.model_name)),e.xp6(3),e.Oqu(e.xi3(8,5,s.updated_at,"MM/dd/yy, HH:mm"))}}function te(o,n){if(1&o){const s=e.EpF();e.TgZ(0,"div",24)(1,"h5",25),e._uU(2),e.ALo(3,"translate"),e.qZA()(),e.TgZ(4,"div",26)(5,"app-permission-form",27),e.NdJ("permissionsChanged",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.permissionsChanged())}),e.qZA()(),e.TgZ(6,"div",28)(7,"button",29),e.NdJ("click",function(){const r=e.CHM(s).$implicit;return e.KtG(r.close("Close click"))}),e._uU(8),e.ALo(9,"translate"),e.qZA()()}2&o&&(e.xp6(2),e.Oqu(e.lcZ(3,3,"Modules.Permissions.AddPermission")),e.xp6(3),e.Q6J("mode","add"),e.xp6(3),e.Oqu(e.lcZ(9,5,"Labels.Close")))}function oe(o,n){if(1&o){const s=e.EpF();e.TgZ(0,"div",24)(1,"h5",25),e._uU(2),e.ALo(3,"translate"),e.qZA()(),e.TgZ(4,"div",26)(5,"app-permission-form",30),e.NdJ("permissionsChanged",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.permissionsChanged())}),e.qZA()(),e.TgZ(6,"div",28)(7,"button",29),e.NdJ("click",function(){const r=e.CHM(s).$implicit;return e.KtG(r.close("Close click"))}),e._uU(8),e.ALo(9,"translate"),e.qZA()()}if(2&o){const s=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,4,"Modules.Permissions.EditPermission")),e.xp6(3),e.Q6J("mode","edit")("permissionData",s.selectedPermission),e.xp6(3),e.Oqu(e.lcZ(9,6,"Labels.Close"))}}function ie(o,n){if(1&o){const s=e.EpF();e.TgZ(0,"div",24)(1,"h5",25),e._uU(2),e.ALo(3,"translate"),e.qZA()(),e.TgZ(4,"div",26)(5,"app-permission-form",30),e.NdJ("permissionsChanged",function(){e.CHM(s);const i=e.oxw();return e.KtG(i.permissionsChanged())}),e.qZA()(),e.TgZ(6,"div",28)(7,"button",29),e.NdJ("click",function(){const r=e.CHM(s).$implicit;return e.KtG(r.close("Close click"))}),e._uU(8),e.ALo(9,"translate"),e.qZA()()}if(2&o){const s=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,4,"Modules.Permissions.ViewPermission")),e.xp6(3),e.Q6J("mode","view")("permissionData",s.selectedPermission),e.xp6(3),e.Oqu(e.lcZ(9,6,"Labels.Close"))}}const ne=[{path:"",component:T,children:[{path:"",component:j},{path:"permissions",component:(()=>{class o{constructor(s,t,i,r){this.gs=s,this.rs=t,this.trans=i,this.modalService=r,this.isLoading=!1,this.unsubscribe$=new _.x,this.permissionList=[],this.dtOptions={},this.dtTrigger=new _.x,this.setBreadcrumb(),this.getPermissions()}ngOnInit(){this.dtOptions={pagingType:"simple_numbers",pageLength:20,responsive:!0,dom:"frtip",order:[[2,"desc"]],language:v.N.dtLanguage}}ngAfterViewInit(){this.dtTrigger.next()}setBreadcrumb(){this.gs.setBreadcrumb([{name:"\u0644\u0648\u062d\u0629 \u0627\u0644\u062a\u062d\u0643\u0645",url:"/"},{name:"\u0627\u0644\u0623\u062f\u0648\u0627\u0631",url:"/roles"},{name:"\u0627\u0644\u0623\u0630\u0648\u0646\u0627\u062a",url:"/roles/permissions"}])}selectPermission(s){this.selectedPermission=s}permissionsChanged(){this.modalService.dismissAll(),this.getPermissions()}getPermissions(){this.isLoading=!0,this.rs.getPermissions().pipe((0,p.R)(this.unsubscribe$)).subscribe(s=>{this.permissionList=s?.data,this.isLoading=!1;const t=this.permissionList.reduce((i,r)=>(i[r.model_name]||(i[r.model_name]=[]),i[r.model_name].push(r),i),{});console.log(t),this.rerender(),console.log(s)})}openModal(s){this.modalService.open(s,{size:"xl",centered:!0})}deletePermission(s){u().fire({title:this.trans.instant("Messages.Sure?"),text:this.trans.instant("Messages.CntRvrt"),icon:"warning",showCancelButton:!0,cancelButtonText:this.trans.instant("Labels.Cancel"),confirmButtonText:this.trans.instant("Labels.Delete")}).then(t=>{t.isConfirmed&&(this.isLoading=!0,this.rs.deletePermission(s.id).pipe((0,p.R)(this.unsubscribe$)).subscribe(i=>{console.log(i),this.isLoading=!1,this.getPermissions(),i.success&&u().fire({icon:"success",text:`${i?.message}`,showConfirmButton:!1,timer:1500})}))})}rerender(){this.dtElement.dtInstance.then(s=>{s.destroy(),this.dtTrigger.next()})}ngOnDestroy(){console.log("distroyed"),this.unsubscribe$.next(),this.unsubscribe$.complete(),console.log("unsubscribe")}}return o.\u0275fac=function(s){return new(s||o)(e.Y36(x.U),e.Y36(f.f),e.Y36(g.sK),e.Y36(h.FF))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-permissions-list"]],viewQuery:function(s,t){if(1&s&&e.Gf(b.G,5),2&s){let i;e.iGM(i=e.CRH())&&(t.dtElement=i.first)}},decls:33,vars:25,consts:[["class","progress mb-3",4,"ngIf"],[1,"page-title"],[1,"text"],[1,"actions"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"fa-solid","fa-plus"],[1,""],[1,"table-responsive"],["datatable","",1,"table","table-hover",3,"dtOptions","dtTrigger"],["scope","col",1,"minw-100"],["scope","col"],[1,"minw-150","text-end"],[4,"ngFor","ngForOf"],["addModal",""],["editModal",""],["viewModal",""],[1,"progress","mb-3"],["role","progressbar","aria-label","Animated striped example","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated",2,"width","100%"],["ngbTooltip","\u0639\u0631\u0636",1,"btn","btn-primary","btn-icon",3,"click"],[1,"fa-regular","fa-eye"],["ngbTooltip","\u062a\u0639\u062f\u064a\u0644",1,"btn","btn-secondary","btn-icon",3,"click"],[1,"fa-regular","fa-pen-to-square"],["ngbTooltip","\u062d\u0630\u0641",1,"btn","btn-danger","btn-icon",3,"click"],[1,"fa-regular","fa-trash-can"],[1,"modal-header"],["ngbAutofocus","",1,"modal-title"],[1,"modal-body"],[3,"mode","permissionsChanged"],[1,"modal-footer"],["type","button",1,"btn","btn-light","btn-sm",3,"click"],[3,"mode","permissionData","permissionsChanged"]],template:function(s,t){if(1&s){const i=e.EpF();e.YNc(0,ee,2,0,"div",0),e.TgZ(1,"div",1)(2,"div",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",3)(6,"a",4),e.NdJ("click",function(){e.CHM(i);const a=e.MAs(28);return e.KtG(t.openModal(a))}),e._UZ(7,"i",5),e._uU(8),e.ALo(9,"translate"),e.qZA()()(),e.TgZ(10,"div",6)(11,"div",7)(12,"table",8)(13,"thead")(14,"tr")(15,"th",9),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"th",10),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"th",10),e._uU(22),e.ALo(23,"translate"),e.qZA(),e._UZ(24,"th",11),e.qZA()(),e.TgZ(25,"tbody"),e.YNc(26,se,16,8,"tr",12),e.qZA()()()(),e.YNc(27,te,10,7,"ng-template",null,13,e.W1O),e.YNc(29,oe,10,8,"ng-template",null,14,e.W1O),e.YNc(31,ie,10,8,"ng-template",null,15,e.W1O)}2&s&&(e.Q6J("ngIf",t.isLoading),e.xp6(1),e.ekj("disabled",t.isLoading),e.xp6(2),e.hij(" ",e.lcZ(4,15,"Modules.Permissions.Title")," "),e.xp6(5),e.hij(" ",e.lcZ(9,17,"Modules.Permissions.AddPermission"),""),e.xp6(2),e.ekj("loading-data",t.isLoading)("disabled",t.isLoading),e.xp6(2),e.Q6J("dtOptions",t.dtOptions)("dtTrigger",t.dtTrigger),e.xp6(4),e.Oqu(e.lcZ(17,19,"Labels.Name")),e.xp6(3),e.Oqu(e.lcZ(20,21,"Labels.Model")),e.xp6(3),e.Oqu(e.lcZ(23,23,"Labels.UpdatedAt")),e.xp6(4),e.Q6J("ngForOf",t.permissionList))},dependencies:[c.sg,c.O5,h._L,b.G,z,c.rS,c.uU,g.X$]}),o})()}]}];let re=(()=>{class o{}return o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[C.Bz.forChild(ne),C.Bz]}),o})();var le=m(6208);let ae=(()=>{class o{}return o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[c.ez,re,h.jF,le.m]}),o})()}}]);